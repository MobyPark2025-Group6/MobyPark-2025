Index: api/services/vehicle_service.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>from fastapi import HTTPException, status\nfrom datetime import datetime\nfrom models.vehicle_models import Vehicle\nfrom models.user_models import User\n\nfrom storage_utils import load_json\nfrom services.validation_service import ValidationService\nfrom storage_utils import load_vehicle_data, save_vehicle_data, load_parking_lot_data\nfrom services.user_service import UserService\nclass VehicleService:\n\n    @staticmethod\n    def getUserVehicleID(session_user : User ):\n        \"\"\"getUserVehicleIDs\"\"\"\n        vehicles = load_vehicle_data()\n        uvehicles = [v['id'] for v in vehicles if v['user_id'] == session_user['id']]\n        return uvehicles\n    \n    @staticmethod\n    def getUserVehicle(session_user : User, vid :str ):\n        \"\"\"getUserVehicle\"\"\"\n        vehicles = load_vehicle_data()\n        uvehicles = [v for v in vehicles if v[\"id\"] == vid]\n        return uvehicles\n    \n    @staticmethod\n    def getUserVehicles(id : str):\n        vehicles = load_vehicle_data()\n        uvehicles = [v for v in vehicles if v[\"user_id\"] == id]\n        return uvehicles\n        \n    \n    @staticmethod\n    def checkForVehicle(session_user : User , Vid : str):\n        \"\"\"Check if the vehicle exists\"\"\"\n\n        uvehicles = VehicleService.getUserVehicleID(session_user)\n        if not Vid in uvehicles:\n                            raise HTTPException(\n                                status_code=status.HTTP_404_NOT_FOUND,\n                                detail=\"Not Found\"\n                        )\n        \n        \n    @staticmethod\n    def check_for_parameters(data):\n        for field in [\"make\", \"license_plate\"]:\n            if not field in data:\n                raise HTTPException(\n                status_code=status.HTTP_400_BAD_REQUEST,\n                detail={\"error\": \"Require field missing\", \"field\": field}\n            )\n        return\n    \n    @staticmethod\n    def check_for_liscense_id(lid, session_user):\n        vehicles = load_vehicle_data()\n        # Extract ALL license plates from the system and normalize them (remove dashes)\n        vehicle_lids = [v[\"license_plate\"] for v in vehicles]\n        \n        if lid in vehicle_lids:\n            raise HTTPException(\n                status_code=status.HTTP_400_BAD_REQUEST,\n                detail={\"error\": \"Vehicle with this license plate already exists in the system\", \"license_plate\": lid}\n            )\n        return\n   \n\n    #Post\n    @staticmethod\n    def CreateVehicle(token: str, data: dict):\n        session_user = ValidationService.validate_session_token(token)\n        VehicleService.check_for_parameters(data)\n\n        vehicles = load_json(\"data/vehicles.json\")\n\n        lid = data[\"license_plate\"].replace(\"-\", \"\")\n        VehicleService.check_for_liscense_id(lid, session_user)\n\n        new_vehicle = {\n            \"id\": len(vehicles) + 1, \n            \"user_id\": session_user[\"id\"],\n            \"license_plate\": data[\"license_plate\"],\n            \"make\": data[\"make\"],\n            \"created_at\": datetime.now().isoformat(),\n            \"updated_at\": datetime.now().isoformat()\n        }\n\n        vehicles.append(new_vehicle)\n\n        save_vehicle_data(vehicles)\n        return {\"status\": \"Success\", \"vehicle\": data}\n\n    @staticmethod\n    def ActOnVehicle(token : str, data : dict) :\n        #Potentially arbirtary, the expected function of acting on a vehicle id might already be handled in parking_service\n        # session_user = ValidationService.validate_session_token(token)\n        # VehicleService.check_for_parameters(data)\n        \n        # lid = data[\"license_plate\"].replace(\"-\", \"\")\n        # vehicles = load_vehicle_data()\n        # if not \"parkinglot\" in data :\n        #     raise HTTPException(\n        #         status_code=status.HTTP_400_BAD_REQUEST,\n        #         detail={\"error\": \"Require field missing\", \"field\": \"parkinglot\"}\n        #     )\n        # not VehicleService.check_for_liscense_id(lid, session_user)\n        # return {\"status\": \"Accepted\", \"vehicle\": vehicles[session_user[\"username\"]][lid]}\n        pass\n        \n \n\n    #Put \n    @staticmethod\n    def ChangeVehicle(token: str, vid: str, NewData: Vehicle):\n\n        session_user = ValidationService.validate_session_token(token)\n        VehicleService.checkForVehicle(session_user, vid)\n        vehicles = load_vehicle_data()\n        index = None\n        for i, v in enumerate(vehicles):\n            if v[\"id\"] == vid and v[\"user_id\"] == session_user[\"id\"]:\n                index = i\n                break\n\n        if index is None:\n            raise ValueError(f\"Vehicle with id {vid} not found for user {session_user['username']}\")\n\n    \n        if not isinstance(NewData, dict):\n            try:\n                NewData = NewData.model_dump() \n            except AttributeError:\n                try:\n                    NewData = NewData.dict()     \n                except AttributeError:\n                    from dataclasses import asdict\n                    NewData = asdict(NewData)    \n\n        \n        vehicles[index] = NewData\n\n  \n        save_vehicle_data(vehicles)\n\n        return {\"status\": \"Success\", \"vehicle\": vehicles[index]}\n\n       \n    \n    #Delete\n    @staticmethod\n    def DeleteVehicle(token : str , vid : str) :\n        vehicles = load_vehicle_data()\n        session_user = ValidationService.validate_session_token(token)\n        VehicleService.checkForVehicle(session_user, vid)\n        cur_vehicle = [v for v in vehicles if v['id'] == vid][0]\n\n        remaining = [v for v in vehicles if v.get(\"license_plate\") != cur_vehicle['license_plate']]\n        save_vehicle_data(remaining)\n\n        updated_vehicles = load_vehicle_data()\n        if all(v.get(\"license_plate\") != cur_vehicle['license_plate'] for v in updated_vehicles) :\n             return {\"Status\" : \"Deleted\"}\n        return {\"Status\" : \"Not Deleted\"}\n    #Get\n    @staticmethod\n\n    def get_all_vehicles_admin_user(token : str, user_name : str): \n        \"\"\"Admin vehicle lookup for a user\"\"\"\n        if ValidationService.check_valid_admin(ValidationService.validate_session_token(token)):\n            user = user_name\n            UserService.user_exists(user)\n            return VehicleService.getUserVehicles==(user)\n        return \n         \n    \n    @staticmethod\n    def get_all_vehicles(token : str): \n        \"\"\"Get all user vehicles \"\"\"\n        print(\"Get all vehicles from a user \")\n        session_user = ValidationService.validate_session_token(token)\n        user = session_user[\"username\"]\n        UserService.user_exists(user)\n        user_vehicles = VehicleService.getUserVehicles(session_user['id'])\n        print(user_vehicles)\n        return user_vehicles\n\n    @staticmethod\n    def get_vehicle_reservations(token : str, vid : str): \n        \"\"\"Get all vehicle reservations for a vehicle\"\"\"\n        session_user = ValidationService.validate_session_token(token)\n        \n        VehicleService.checkForVehicle(session_user, vid)\n        reservations = load_parking_lot_data()\n        vehicle_reservations = [r for r in reservations if r['vehicle_id'] == vid]\n        if not vehicle_reservations:\n            raise HTTPException(status_code=status.HTTP_204_NO_CONTENT, detail=\"No reservations\")\n        return vehicle_reservations\n        \n\n    @staticmethod\n    def get_vehicle_history(token : str, vid : str): \n        \"\"\"Get the vehicle history\"\"\"\n        session_user = ValidationService.validate_session_token(token)\n\n        VehicleService.checkForVehicle(session_user, vid)\n    \n        # TODO In the old code, it returned nothing. For the 'refactor' it was decided to mostly copy over the old code with the new methods applied. This should be changed later\n        # self.send_response(200)\n        # self.send_header(\"Content-type\", \"application/json\")\n        # self.end_headers()\n        # self.wfile.write(json.dumps([]).encode(\"utf-8\"))\n        return\n        \n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/api/services/vehicle_service.py b/api/services/vehicle_service.py
--- a/api/services/vehicle_service.py	(revision c87091f31c989a34f45859ec44648f411279eaa5)
+++ b/api/services/vehicle_service.py	(date 1762780564857)
@@ -41,7 +41,6 @@
                                 detail="Not Found"
                         )
         
-        
     @staticmethod
     def check_for_parameters(data):
         for field in ["make", "license_plate"]:
